data:
  image: bibcnrs/data
  volumes:
    - /var/lib/mysql

wordpress:
  image: bibcnrs/wordpress
  ports:
    - 8080:8080
  links:
    - db:mysql
  environment:
    http_proxy: ${http_proxy}
    https_proxy: ${https_proxy}
    WORDPRESS_DB_PASSWORD: ${DB_PASSWORD}
  working_dir: /var/www/html
  volumes:
    - ./wp-content/plugins:/var/www/html/wp-content/plugins
    - ./wp-content/themes:/var/www/html/wp-content/themes
    - ./wp-content/vendor:/var/www/html/wp-content/vendor
    - ./wp-content/uploads:/var/www/html/wp-content/uploads

db:
  image: mariadb:10.0
  environment:
    MYSQL_ROOT_PASSWORD: ${DB_PASSWORD}
    PORT: 3305
    TERM: dumb
  volumes_from:
    - data

composer:
  image: bibcnrs/composer-npm
  environment:
    http_proxy: ${http_proxy}
    https_proxy: ${https_proxy}
  volumes:
    - .:/app

compass:
  image: bibcnrs/compass
  volumes:
    - ./sass:/src/sass
    - ./config.rb:/src/config.rb
  command: compile

wpcli:
  image: bibcnrs/appstack-wpcli
  links:
    - db:mysql
  environment:
    WORDPRESS_DB_PASSWORD: ${DB_PASSWORD}
  volumes_from:
    - wordpress
